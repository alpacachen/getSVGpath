!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const n=function(t,e,i){let n,s=null;return function(){let o=this,h=arguments,a=+new Date;clearTimeout(s),n||(n=a),a-n>=i?(t.apply(o,h),n=a):s=setTimeout(function(){t.apply(o,h)},e)}},s=(t=[],e=1)=>{let i="";return t.forEach((t,n)=>{let s="L";0===n&&(s="M"),i+=`${s}${t[0]*e} ${t[1]*e} `}),i};var o=class{constructor(t){this.x=t.x,this.y=t.y,this.lineWidth=t.lineWidth,this.width=t.width,this.height=t.height,this.opacity=t.opacity||.8,this.path=[],this.onSure=t.onSure,this.canvas=null,this.ctx=null,this.div=null,this.mode="free"}draw(){this.render(),this.mode_free()}render(){this.div=document.createElement("div"),this.div.innerHTML=`\n            <div id='SVGpath_wrap' style="position:absolute;top:${this.y}px;left:${this.x}px;width:${this.width}px;height:${this.height}px;box-shadow: 0 0 10px #000;background: #fff;opacity:${this.opacity};border-radius: 4px;z-index: 1;">\n                <canvas id="SVGpath_Canvas" width=${this.width} height=${this.height}></canvas>\n                <div style="text-align: right;position: relative;top: -28px;padding: 0 8px;">\n                    <button id="SVGpath_cancel">cancel</button>\n                    <button id="SVGpath_sure">sure</button>\n                </div>\n                <div style="top: -28px;position: absolute;top: -12px;right: 0;">\n                    <button id="SVGpath_free">free mode</button>\n                    <button id="SVGpath_line">line mode</button>\n                </div>\n            </div>\n        `,document.body.appendChild(this.div),this.canvas=document.getElementById("SVGpath_Canvas"),this.ctx=this.canvas.getContext("2d"),document.getElementById("SVGpath_sure").onclick=(()=>{this.onSure({data:this.path,baseWidth:this.width}),document.body.removeChild(this.div)}),document.getElementById("SVGpath_cancel").onclick=(()=>{document.body.removeChild(this.div)}),document.getElementById("SVGpath_free").onclick=(()=>{this.cmode("free"),this.clear(),this.mode_free()}),document.getElementById("SVGpath_line").onclick=(()=>{this.cmode("line"),this.clear(),this.mode_line()})}mode_line(){this.path=[];let t=[],e=null;this.ctx.lineWidth=3;const i=(e,i)=>{let n=null;return t.forEach((t,s)=>{const o=t[0],h=t[1];e<o+5&&e>o-5&&i<h+5&&i>h-5&&(n=s)}),n},s=()=>{this.ctx.beginPath();for(let e=0;e<this.path.length;e++)if(this.add_arc(this.path[e][0],this.path[e][1],5,0,2*Math.PI,!1,"orange"),this.ctx.moveTo(this.path[e][0],this.path[e][1]),this.path[e+1]){let i=t[e][0],n=t[e][1];this.ctx.quadraticCurveTo(i,n,this.path[e+1][0],this.path[e+1][1]),this.ctx.stroke(),this.add_arc(i,n,5,0,2*Math.PI,!1,"gray")}};this.canvas.onmousedown=(n=>{const o=i(n.offsetX,n.offsetY);if(null===o){if(this.path.push([n.offsetX,n.offsetY]),this.path.length>1){let e=this.path.length,i=(n.offsetX+this.path[e-2][0])/2,s=(n.offsetY+this.path[e-2][1])/2;t.push([i,s])}s()}else e=o}),this.canvas.onmousemove=n(n=>{const o=i(n.offsetX,n.offsetY);document.body.style.cursor=null!==o?"pointer":"default",null!==e&&(t.splice(e,1,[n.offsetX,n.offsetY]),this.ctx.clearRect(0,0,this.width,this.height),s())},70,80),this.canvas.onmouseup=(()=>e=null),this.canvas.mouseout=(()=>e=null)}mode_free(){this.path=[];let t=!1,e=0,i=0;this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.lineWidth||5,this.ctx.strokeStyle="#666666",this.canvas.onmousedown=(n=>{t=!0,[e,i]=[n.offsetX,n.offsetY],this.path.push([n.offsetX,n.offsetY])}),this.canvas.onmousemove=n(n=>{t&&(this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(n.offsetX,n.offsetY),this.ctx.stroke(),[e,i]=[n.offsetX,n.offsetY],this.path.push([n.offsetX,n.offsetY]))},50,60),this.canvas.onmouseup=(()=>t=!1),this.canvas.mouseout=(()=>t=!1)}add_arc(t,e,i,n,s,o,h){this.ctx.beginPath(),this.ctx.fillStyle=h,this.ctx.arc(t,e,i,n,s,o),this.ctx.fill(),this.ctx.lineWidth=1,this.ctx.strokeStyle="black",this.ctx.stroke()}clear(){this.path=[],this.ctx.clearRect(0,0,this.width,this.height),this.canvas.onmousedown=null,this.canvas.onmousemove=null,this.canvas.onmouseup=null,this.canvas.mouseout=null}cmode(t){this.mode=t}};const{x:h,y:a,width:l,height:c}=document.getElementById("inner").getBoundingClientRect();let d=new o({x:h,y:a,width:l,height:c,opacity:.5,lineWidth:3,onSure:function(t){console.log(t),console.log(s(t.data)),document.getElementById("data").innerHTML=s(t.data)}});document.getElementById("start").onclick=(()=>d.draw())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vdGVzdC9pbmRleC5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInRocm90dGxlIiwiZm4iLCJkZWxheSIsIm11c3RSdW5EZWxheSIsInRfc3RhcnQiLCJ0aW1lciIsImNvbnRleHQiLCJ0aGlzIiwiYXJncyIsImFyZ3VtZW50cyIsInRfY3VyciIsIkRhdGUiLCJjbGVhclRpbWVvdXQiLCJhcHBseSIsInNldFRpbWVvdXQiLCJwYXRoMnN0cmluZyIsImFycmF5IiwicmF0aW8iLCJzdHIiLCJmb3JFYWNoIiwiaXRlbSIsImluZGV4IiwiY2hyIiwiW29iamVjdCBPYmplY3RdIiwib3B0IiwieCIsInkiLCJsaW5lV2lkdGgiLCJ3aWR0aCIsImhlaWdodCIsIm9wYWNpdHkiLCJwYXRoIiwib25TdXJlIiwiY2FudmFzIiwiY3R4IiwiZGl2IiwicmVuZGVyIiwibW9kZV9mcmVlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiYm9keSIsImFwcGVuZENoaWxkIiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0Iiwib25jbGljayIsImRhdGEiLCJiYXNlV2lkdGgiLCJyZW1vdmVDaGlsZCIsImNtb2RlIiwiY2xlYXIiLCJtb2RlX2xpbmUiLCJxX3BhdGgiLCJpc0RyYXdpbmdfaWR4IiwiZmluZHEiLCJpZHgiLCJpeCIsIml5IiwiZHJhd19saW5lcyIsImJlZ2luUGF0aCIsImxlbmd0aCIsImFkZF9hcmMiLCJNYXRoIiwiUEkiLCJtb3ZlVG8iLCJxeCIsInF5IiwicXVhZHJhdGljQ3VydmVUbyIsInN0cm9rZSIsIm9ubW91c2Vkb3duIiwiZSIsImlucSIsIm9mZnNldFgiLCJvZmZzZXRZIiwicHVzaCIsImxlbiIsIm9ubW91c2Vtb3ZlIiwic3R5bGUiLCJjdXJzb3IiLCJzcGxpY2UiLCJjbGVhclJlY3QiLCJvbm1vdXNldXAiLCJtb3VzZW91dCIsImlzRHJhd2luZyIsImxhc3RYIiwibGFzdFkiLCJsaW5lQ2FwIiwibGluZUpvaW4iLCJzdHJva2VTdHlsZSIsImxpbmVUbyIsInNhIiwiZWEiLCJjb3VudGVyY2xvY2t3aXNlIiwiY29sb3IiLCJmaWxsU3R5bGUiLCJhcmMiLCJmaWxsIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwic3ZnIiwicmVzIiwiY29uc29sZSIsImxvZyIsImRyYXciXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFD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QXFCLE1BQUFyQixLQUFBc0IsUUFDQXRCLEtBQUEwQixPQUFBb0MsWUFBQSxLQUNBOUQsS0FBQTBCLE9BQUEyQyxZQUFBLEtBQ0FyRSxLQUFBMEIsT0FBQWdELFVBQUEsS0FDQTFFLEtBQUEwQixPQUFBaUQsU0FBQSxLQUVBM0QsTUFBQXBDLEdBQ0FvQixLQUFBcEIsU0NyS0EsTUFBQXNDLEVBQU9BLEVBQUFDLElBQUFFLFFBQUFDLFVBQXNCUyxTQUFBSyxlQUFBLFNBQUFzRCx3QkFDN0IsSUFBQUMsRUFBQSxJQUFjN0UsRUFBTyxDQUNyQkksSUFDQUMsSUFDQUUsUUFDQUMsU0FDQUMsUUFBQSxHQUNBSCxVQUFBLEVBQ0FLLE9BQUEsU0FBQW1FLEdBQ0FDLFFBQUFDLElBQUFGLEdBQ0FDLFFBQUFDLElBQW9CdEYsRUFBV29GLEVBQUFyRCxPQUMvQlIsU0FBQUssZUFBQSxRQUFBSCxVQUFvRHpCLEVBQVdvRixFQUFBckQsU0FHL0RSLFNBQUFLLGVBQUEsU0FBQUUsUUFBQSxLQUFBcUQsRUFBQUkiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImNsYXNzIFNWR3BhdGgge1xuICAgIGNvbnN0cnVjdG9yKG9wdCkge1xuICAgICAgICB0aGlzLnggPSBvcHQueDtcbiAgICAgICAgdGhpcy55ID0gb3B0Lnk7XG4gICAgICAgIHRoaXMubGluZVdpZHRoID0gb3B0LmxpbmVXaWR0aDtcbiAgICAgICAgdGhpcy53aWR0aCA9IG9wdC53aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBvcHQuaGVpZ2h0O1xuICAgICAgICB0aGlzLm9wYWNpdHkgPSBvcHQub3BhY2l0eSB8fCAwLjg7XG4gICAgICAgIHRoaXMucGF0aCA9IFtdO1xuICAgICAgICB0aGlzLm9uU3VyZSA9IG9wdC5vblN1cmU7XG4gICAgICAgIHRoaXMuY2FudmFzID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdHggPSBudWxsO1xuICAgICAgICB0aGlzLmRpdiA9IG51bGw7XG4gICAgICAgIHRoaXMubW9kZSA9ICdmcmVlJztcbiAgICB9XG4gICAgZHJhdygpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgdGhpcy5tb2RlX2ZyZWUoKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICB0aGlzLmRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLmRpdi5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8ZGl2IGlkPSdTVkdwYXRoX3dyYXAnIHN0eWxlPVwicG9zaXRpb246YWJzb2x1dGU7dG9wOiR7dGhpcy55fXB4O2xlZnQ6JHt0aGlzLnh9cHg7d2lkdGg6JHt0aGlzLndpZHRofXB4O2hlaWdodDoke1xuICAgICAgICAgICAgdGhpcy5oZWlnaHRcbiAgICAgICAgICAgIH1weDtib3gtc2hhZG93OiAwIDAgMTBweCAjMDAwO2JhY2tncm91bmQ6ICNmZmY7b3BhY2l0eToke3RoaXMub3BhY2l0eX07Ym9yZGVyLXJhZGl1czogNHB4O3otaW5kZXg6IDE7XCI+XG4gICAgICAgICAgICAgICAgPGNhbnZhcyBpZD1cIlNWR3BhdGhfQ2FudmFzXCIgd2lkdGg9JHt0aGlzLndpZHRofSBoZWlnaHQ9JHt0aGlzLmhlaWdodH0+PC9jYW52YXM+XG4gICAgICAgICAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IHJpZ2h0O3Bvc2l0aW9uOiByZWxhdGl2ZTt0b3A6IC0yOHB4O3BhZGRpbmc6IDAgOHB4O1wiPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwiU1ZHcGF0aF9jYW5jZWxcIj5jYW5jZWw8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cIlNWR3BhdGhfc3VyZVwiPnN1cmU8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPVwidG9wOiAtMjhweDtwb3NpdGlvbjogYWJzb2x1dGU7dG9wOiAtMTJweDtyaWdodDogMDtcIj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cIlNWR3BhdGhfZnJlZVwiPmZyZWUgbW9kZTwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwiU1ZHcGF0aF9saW5lXCI+bGluZSBtb2RlPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmRpdik7XG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1NWR3BhdGhfQ2FudmFzJyk7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1NWR3BhdGhfc3VyZScpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uU3VyZSh7IGRhdGE6IHRoaXMucGF0aCwgYmFzZVdpZHRoOiB0aGlzLndpZHRoIH0pO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmRpdik7XG4gICAgICAgIH07XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdTVkdwYXRoX2NhbmNlbCcpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuZGl2KTtcbiAgICAgICAgfTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1NWR3BhdGhfZnJlZScpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNtb2RlKCdmcmVlJyk7XG4gICAgICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLm1vZGVfZnJlZSgpO1xuICAgICAgICB9O1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnU1ZHcGF0aF9saW5lJykub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY21vZGUoJ2xpbmUnKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgICAgIHRoaXMubW9kZV9saW5lKCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIG1vZGVfbGluZSgpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gW107XG4gICAgICAgIGxldCBxX3BhdGggPSBbXVxuICAgICAgICBsZXQgaXNEcmF3aW5nX2lkeCA9IG51bGxcbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMztcbiAgICAgICAgY29uc3QgZmluZHEgPSAoeCwgeSkgPT4ge1xuICAgICAgICAgICAgbGV0IGlkeCA9IG51bGxcbiAgICAgICAgICAgIHFfcGF0aC5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGl4ID0gaXRlbVswXVxuICAgICAgICAgICAgICAgIGNvbnN0IGl5ID0gaXRlbVsxXVxuICAgICAgICAgICAgICAgIGlmICh4IDwgaXggKyA1ICYmIHggPiBpeCAtIDUgJiYgeSA8IGl5ICsgNSAmJiB5ID4gaXkgLSA1KSB7XG4gICAgICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBpZHhcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkcmF3X2xpbmVzID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIC8v5Y6f54K5XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRfYXJjKHRoaXMucGF0aFtpXVswXSwgdGhpcy5wYXRoW2ldWzFdLCA1LCAwLCAyICogTWF0aC5QSSwgZmFsc2UsICdvcmFuZ2UnKVxuICAgICAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbyh0aGlzLnBhdGhbaV1bMF0sIHRoaXMucGF0aFtpXVsxXSk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGF0aFtpICsgMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHF4ID0gcV9wYXRoW2ldWzBdXG4gICAgICAgICAgICAgICAgICAgIGxldCBxeSA9IHFfcGF0aFtpXVsxXVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHF4LCBxeSwgdGhpcy5wYXRoW2kgKyAxXVswXSwgdGhpcy5wYXRoW2kgKyAxXVsxXSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgICAgICAvL+S4reeCuVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZF9hcmMocXgsIHF5LCA1LCAwLCAyICogTWF0aC5QSSwgZmFsc2UsICdncmF5JylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2Vkb3duID0gZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbnEgPSBmaW5kcShlLm9mZnNldFgsIGUub2Zmc2V0WSlcbiAgICAgICAgICAgIGlmIChpbnEgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpc0RyYXdpbmdfaWR4ID0gaW5xXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBbbGFzdFgsIGxhc3RZXSA9IFtlLm9mZnNldFgsIGUub2Zmc2V0WV07XG4gICAgICAgICAgICB0aGlzLnBhdGgucHVzaChbZS5vZmZzZXRYLCBlLm9mZnNldFldKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhdGgubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGxldCBsZW4gPSB0aGlzLnBhdGgubGVuZ3RoXG4gICAgICAgICAgICAgICAgbGV0IHF4ID0gKGUub2Zmc2V0WCArIHRoaXMucGF0aFtsZW4gLSAyXVswXSkgLyAyXG4gICAgICAgICAgICAgICAgbGV0IHF5ID0gKGUub2Zmc2V0WSArIHRoaXMucGF0aFtsZW4gLSAyXVsxXSkgLyAyXG4gICAgICAgICAgICAgICAgcV9wYXRoLnB1c2goW3F4LCBxeV0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkcmF3X2xpbmVzKClcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jYW52YXMub25tb3VzZW1vdmUgPSB0aHJvdHRsZShlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlkeCA9IGZpbmRxKGUub2Zmc2V0WCwgZS5vZmZzZXRZKSAvLyDliKTmlq3pvKDmoIflnKjlk6rkuKrkuK3ngrnkuIpcbiAgICAgICAgICAgIGlmIChpZHggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJ1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0J1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzRHJhd2luZ19pZHggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBxX3BhdGguc3BsaWNlKGlzRHJhd2luZ19pZHgsIDEsIFtlLm9mZnNldFgsIGUub2Zmc2V0WV0pXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsMCx0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KVxuICAgICAgICAgICAgICAgIGRyYXdfbGluZXMoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCA3MCwgODApXG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2V1cCA9ICgpID0+IChpc0RyYXdpbmdfaWR4ID0gbnVsbCk7XG4gICAgICAgIHRoaXMuY2FudmFzLm1vdXNlb3V0ID0gKCkgPT4gKGlzRHJhd2luZ19pZHggPSBudWxsKTtcbiAgICB9XG4gICAgbW9kZV9mcmVlKCkge1xuICAgICAgICB0aGlzLnBhdGggPSBbXTtcbiAgICAgICAgbGV0IGlzRHJhd2luZyA9IGZhbHNlO1xuICAgICAgICBsZXQgbGFzdFggPSAwO1xuICAgICAgICBsZXQgbGFzdFkgPSAwO1xuICAgICAgICB0aGlzLmN0eC5saW5lQ2FwID0gJ3JvdW5kJztcbiAgICAgICAgdGhpcy5jdHgubGluZUpvaW4gPSAncm91bmQnO1xuICAgICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSB0aGlzLmxpbmVXaWR0aCB8fCA1O1xuICAgICAgICBjb25zdCBkcmF3TGluZSA9IGUgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc0RyYXdpbmcpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKGxhc3RYLCBsYXN0WSk7XG4gICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oZS5vZmZzZXRYLCBlLm9mZnNldFkpO1xuICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XG4gICAgICAgICAgICBbbGFzdFgsIGxhc3RZXSA9IFtlLm9mZnNldFgsIGUub2Zmc2V0WV07XG4gICAgICAgICAgICB0aGlzLnBhdGgucHVzaChbZS5vZmZzZXRYLCBlLm9mZnNldFldKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSAnIzY2NjY2Nic7XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2Vkb3duID0gZSA9PiB7XG4gICAgICAgICAgICBpc0RyYXdpbmcgPSB0cnVlO1xuICAgICAgICAgICAgW2xhc3RYLCBsYXN0WV0gPSBbZS5vZmZzZXRYLCBlLm9mZnNldFldO1xuICAgICAgICAgICAgdGhpcy5wYXRoLnB1c2goW2Uub2Zmc2V0WCwgZS5vZmZzZXRZXSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2Vtb3ZlID0gdGhyb3R0bGUoZHJhd0xpbmUsIDUwLCA2MCk7XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2V1cCA9ICgpID0+IChpc0RyYXdpbmcgPSBmYWxzZSk7XG4gICAgICAgIHRoaXMuY2FudmFzLm1vdXNlb3V0ID0gKCkgPT4gKGlzRHJhd2luZyA9IGZhbHNlKTtcbiAgICB9XG4gICAgYWRkX2FyYyh4LCB5LCByLCBzYSwgZWEsIGNvdW50ZXJjbG9ja3dpc2UsIGNvbG9yKSB7XG4gICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpXG4gICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9IGNvbG9yXG4gICAgICAgIHRoaXMuY3R4LmFyYyh4LCB5LCByLCBzYSwgZWEsIGNvdW50ZXJjbG9ja3dpc2UpO1xuICAgICAgICB0aGlzLmN0eC5maWxsKClcbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMTtcbiAgICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSAnYmxhY2snO1xuICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMucGF0aCA9IFtdO1xuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICB0aGlzLmNhbnZhcy5vbm1vdXNlZG93biA9IG51bGw7XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2Vtb3ZlID0gbnVsbDtcbiAgICAgICAgdGhpcy5jYW52YXMub25tb3VzZXVwID0gbnVsbDtcbiAgICAgICAgdGhpcy5jYW52YXMubW91c2VvdXQgPSBudWxsO1xuICAgIH1cbiAgICBjbW9kZShtb2RlKSB7XG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgfVxufVxuXG4vL+iKgua1geWHveaVsO+8jOatpOWkhOeUqOadpeW/q+mAn+eUu+ebtOe6v1xuY29uc3QgdGhyb3R0bGUgPSBmdW5jdGlvbiAoZm4sIGRlbGF5LCBtdXN0UnVuRGVsYXkpIHtcbiAgICBsZXQgdGltZXIgPSBudWxsO1xuICAgIGxldCB0X3N0YXJ0O1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBjb250ZXh0ID0gdGhpcyxcbiAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgICAgICB0X2N1cnIgPSArbmV3IERhdGUoKTtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgaWYgKCF0X3N0YXJ0KSB7XG4gICAgICAgICAgICB0X3N0YXJ0ID0gdF9jdXJyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0X2N1cnIgLSB0X3N0YXJ0ID49IG11c3RSdW5EZWxheSkge1xuICAgICAgICAgICAgZm4uYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICB0X3N0YXJ0ID0gdF9jdXJyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgfVxuICAgIH07XG59O1xuXG4vL+WwhuS6jOe7tOaVsOe7hOi9rHN2ZyBwYXRo5qC85byPXG5jb25zdCBwYXRoMnN0cmluZyA9IChhcnJheSA9IFtdLCByYXRpbyA9IDEpID0+IHtcbiAgICBsZXQgc3RyID0gJyc7XG4gICAgYXJyYXkuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgbGV0IGNociA9ICdMJztcbiAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICBjaHIgPSAnTSc7XG4gICAgICAgIH1cbiAgICAgICAgc3RyICs9IGAke2Nocn0ke2l0ZW1bMF0gKiByYXRpb30gJHtpdGVtWzFdICogcmF0aW99IGA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHN0cjtcbn07XG5leHBvcnQgZGVmYXVsdCBTVkdwYXRoO1xuZXhwb3J0IHsgcGF0aDJzdHJpbmcgfTtcbiIsImltcG9ydCBTVkdwYXRoLCB7IHBhdGgyc3RyaW5nIH0gZnJvbSAnLi4vaW5kZXgnXG5jb25zdCB7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbm5lcicpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG5sZXQgc3ZnID0gbmV3IFNWR3BhdGgoe1xuICAgIHgsXG4gICAgeSxcbiAgICB3aWR0aCxcbiAgICBoZWlnaHQsXG4gICAgb3BhY2l0eTogMC41LFxuICAgIGxpbmVXaWR0aDogMyxcbiAgICBvblN1cmU6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICBjb25zb2xlLmxvZyhwYXRoMnN0cmluZyhyZXMuZGF0YSkpXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhJykuaW5uZXJIVE1MID0gcGF0aDJzdHJpbmcocmVzLmRhdGEpXG4gICAgfVxufSlcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydCcpLm9uY2xpY2sgPSAoKSA9PiBzdmcuZHJhdygpIl0sInNvdXJjZVJvb3QiOiIifQ==