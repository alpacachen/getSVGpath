!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=function(t,e,i){let s,n=null;return function(){let h=this,o=arguments,a=+new Date;clearTimeout(n),s||(s=a),a-s>=i?(t.apply(h,o),s=a):n=setTimeout(function(){t.apply(h,o)},e)}},n=(t=[],e=1)=>{let i="";return t.forEach((t,s)=>{let n="L";0===s&&(n="M"),t[2]&&(n=`Q${t[2][0]*e} ${t[2][1]*e}`),i+=`${n} ${t[0]*e} ${t[1]*e} `}),i};var h=class{constructor(t){this.x=t.x,this.y=t.y,this.lineWidth=t.lineWidth,this.width=t.width,this.height=t.height,this.opacity=t.opacity||.8,this.path=[],this.onSure=t.onSure,this.canvas=null,this.ctx=null,this.div=null,this.mode="free"}draw(){this.render(),this.mode_free()}render(){this.div=document.createElement("div"),this.div.innerHTML=`\n            <div id='SVGpath_wrap' style="position:absolute;top:${this.y}px;left:${this.x}px;width:${this.width}px;height:${this.height}px;box-shadow: 0 0 10px #000;background: #fff;opacity:${this.opacity};border-radius: 4px;z-index: 1;">\n                <canvas id="SVGpath_Canvas" width=${this.width} height=${this.height}></canvas>\n                <div style="text-align: right;position: relative;top: -28px;padding: 0 8px;">\n                    <button id="SVGpath_cancel">cancel</button>\n                    <button id="SVGpath_sure">sure</button>\n                </div>\n                <div style="top: -28px;position: absolute;top: -12px;right: 0;">\n                    <button id="SVGpath_free">free mode</button>\n                    <button id="SVGpath_line">line mode</button>\n                </div>\n            </div>\n        `,document.body.appendChild(this.div),this.canvas=document.getElementById("SVGpath_Canvas"),this.ctx=this.canvas.getContext("2d"),document.getElementById("SVGpath_sure").onclick=(()=>{this.onSure({data:this.path,baseWidth:this.width}),document.body.removeChild(this.div)}),document.getElementById("SVGpath_cancel").onclick=(()=>{document.body.removeChild(this.div)}),document.getElementById("SVGpath_free").onclick=(()=>{this.cmode("free"),this.clear(),this.mode_free()}),document.getElementById("SVGpath_line").onclick=(()=>{this.cmode("line"),this.clear(),this.mode_line()})}mode_line(){this.path=[];let t=null;this.ctx.lineWidth=3;const e=(t,e)=>{let i=null;return this.path.forEach((s,n)=>{if(!s[2])return;const h=s[2][0],o=s[2][1];t<h+5&&t>h-5&&e<o+5&&e>o-5&&(i=n)}),i},i=()=>{this.ctx.beginPath();for(let t=0;t<this.path.length;t++)if(this.add_arc(this.path[t][0],this.path[t][1],5,0,2*Math.PI,!1,"orange"),this.ctx.moveTo(this.path[t][0],this.path[t][1]),this.ctx.save(),this.path[t+1]){let e=this.path[t+1][2][0],i=this.path[t+1][2][1];this.ctx.quadraticCurveTo(e,i,this.path[t+1][0],this.path[t+1][1]),this.ctx.stroke(),this.ctx.restore(),this.add_arc(e,i,5,0,2*Math.PI,!1,"gray"),this.ctx.setLineDash([2,2]),this.add_line(e,i,this.path[t][0],this.path[t][1]),this.add_line(e,i,this.path[t+1][0],this.path[t+1][1]),this.ctx.setLineDash([])}};this.canvas.onmousedown=(s=>{const n=e(s.offsetX,s.offsetY);if(null===n){if(this.path.push([s.offsetX,s.offsetY]),this.path.length>1){let t=this.path.length,e=(s.offsetX+this.path[t-2][0])/2,i=(s.offsetY+this.path[t-2][1])/2;this.path[t-1].push([e,i])}i()}else t=n}),this.canvas.onmousemove=s(s=>{const n=e(s.offsetX,s.offsetY);document.body.style.cursor=null!==n?"pointer":"default",null!==t&&(this.path[t].splice(2,1,[s.offsetX,s.offsetY]),this.ctx.clearRect(0,0,this.width,this.height),i())},70,80),this.canvas.onmouseup=(()=>t=null),this.canvas.mouseout=(()=>t=null)}mode_free(){this.path=[];let t=!1,e=0,i=0;this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.lineWidth||5,this.ctx.strokeStyle="#666666",this.canvas.onmousedown=(s=>{t=!0,[e,i]=[s.offsetX,s.offsetY],this.path.push([s.offsetX,s.offsetY])}),this.canvas.onmousemove=s(s=>{t&&(this.ctx.beginPath(),this.ctx.moveTo(e,i),this.ctx.lineTo(s.offsetX,s.offsetY),this.ctx.stroke(),[e,i]=[s.offsetX,s.offsetY],this.path.push([s.offsetX,s.offsetY]))},50,60),this.canvas.onmouseup=(()=>t=!1),this.canvas.mouseout=(()=>t=!1)}add_arc(t,e,i,s,n,h,o){this.ctx.beginPath(),this.ctx.fillStyle=o,this.ctx.arc(t,e,i,s,n,h),this.ctx.fill(),this.ctx.lineWidth=1,this.ctx.strokeStyle="black",this.ctx.stroke()}add_line(t,e,i,s){this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.stroke()}clear(){this.path=[],this.ctx.clearRect(0,0,this.width,this.height),this.canvas.onmousedown=null,this.canvas.onmousemove=null,this.canvas.onmouseup=null,this.canvas.mouseout=null}cmode(t){this.mode=t}};const{x:o,y:a,width:c,height:l}=document.getElementById("inner").getBoundingClientRect();let d=new h({x:o,y:a,width:c,height:l,opacity:.5,lineWidth:3,onSure:function(t){console.log(t),console.log(n(t.data)),document.getElementById("data").innerHTML=n(t.data)}});document.getElementById("start").onclick=(()=>d.draw())}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vdGVzdC9pbmRleC5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInRocm90dGxlIiwiZm4iLCJkZWxheSIsIm11c3RSdW5EZWxheSIsInRfc3RhcnQiLCJ0aW1lciIsImNvbnRleHQiLCJ0aGlzIiwiYXJncyIsImFyZ3VtZW50cyIsInRfY3VyciIsIkRhdGUiLCJjbGVhclRpbWVvdXQiLCJhcHBseSIsInNldFRpbWVvdXQiLCJwYXRoMnN0cmluZyIsImFycmF5IiwicmF0aW8iLCJzdHIiLCJmb3JFYWNoIiwiaXRlbSIsImluZGV4IiwiY2hyIiwiW29iamVjdCBPYmplY3RdIiwib3B0IiwieCIsInkiLCJsaW5lV2lkdGgiLCJ3aWR0aCIsImhlaWdodCIsIm9wYWNpdHkiLCJwYXRoIiwib25TdXJlIiwiY2FudmFzIiwiY3R4IiwiZGl2IiwicmVuZGVyIiwibW9kZV9mcmVlIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiYm9keSIsImFwcGVuZENoaWxkIiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0Iiwib25jbGljayIsImRhdGEiLCJiYXNlV2lkdGgiLCJyZW1vdmVDaGlsZCIsImNtb2RlIiwiY2xlYXIiLCJtb2RlX2xpbmUiLCJpc0RyYXdpbmdfaWR4IiwiZmluZHEiLCJpZHgiLCJpeCIsIml5IiwiZHJhd19saW5lcyIsImJlZ2luUGF0aCIsImxlbmd0aCIsImFkZF9hcmMiLCJNYXRoIiwiUEkiLCJtb3ZlVG8iLCJzYXZlIiwicXgiLCJxeSIsInF1YWRyYXRpY0N1cnZlVG8iLCJzdHJva2UiLCJyZXN0b3JlIiwic2V0TGluZURhc2giLCJhZGRfbGluZSIsIm9ubW91c2Vkb3duIiwiZSIsImlucSIsIm9mZnNldFgiLCJvZmZzZXRZIiwicHVzaCIsImxlbiIsIm9ubW91c2Vtb3ZlIiwic3R5bGUiLCJjdXJzb3IiLCJzcGxpY2UiLCJjbGVhclJlY3QiLCJvbm1vdXNldXAiLCJtb3VzZW91dCIsImlzRHJhd2luZyIsImxhc3RYIiwibGFzdFkiLCJsaW5lQ2FwIiwibGluZUpvaW4iLCJzdHJva2VTdHlsZSIsImxpbmVUbyIsInNhIiwiZWEiLCJjb3VudGVyY2xvY2t3aXNlIiwiY29sb3IiLCJmaWxsU3R5bGUiLCJhcmMiLCJmaWxsIiwic3giLCJzeSIsImV4IiwiZXkiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzdmciLCJyZXMiLCJjb25zb2xlIiwibG9nIiwiZHJhdyJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FH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QUFvQjdGLEVBQVcyRixFQUFBNUQsT0FDL0JSLFNBQUFLLGVBQUEsUUFBQUgsVUFBb0R6QixFQUFXMkYsRUFBQTVELFNBRy9EUixTQUFBSyxlQUFBLFNBQUFFLFFBQUEsS0FBQTRELEVBQUFJIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJjbGFzcyBTVkdwYXRoIHtcbiAgICBjb25zdHJ1Y3RvcihvcHQpIHtcbiAgICAgICAgdGhpcy54ID0gb3B0Lng7XG4gICAgICAgIHRoaXMueSA9IG9wdC55O1xuICAgICAgICB0aGlzLmxpbmVXaWR0aCA9IG9wdC5saW5lV2lkdGg7XG4gICAgICAgIHRoaXMud2lkdGggPSBvcHQud2lkdGg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0LmhlaWdodDtcbiAgICAgICAgdGhpcy5vcGFjaXR5ID0gb3B0Lm9wYWNpdHkgfHwgMC44O1xuICAgICAgICB0aGlzLnBhdGggPSBbXTtcbiAgICAgICAgdGhpcy5vblN1cmUgPSBvcHQub25TdXJlO1xuICAgICAgICB0aGlzLmNhbnZhcyA9IG51bGw7XG4gICAgICAgIHRoaXMuY3R4ID0gbnVsbDtcbiAgICAgICAgdGhpcy5kaXYgPSBudWxsO1xuICAgICAgICB0aGlzLm1vZGUgPSAnZnJlZSc7XG4gICAgfVxuICAgIGRyYXcoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgIHRoaXMubW9kZV9mcmVlKCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5kaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5kaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGRpdiBpZD0nU1ZHcGF0aF93cmFwJyBzdHlsZT1cInBvc2l0aW9uOmFic29sdXRlO3RvcDoke3RoaXMueX1weDtsZWZ0OiR7dGhpcy54fXB4O3dpZHRoOiR7dGhpcy53aWR0aH1weDtoZWlnaHQ6JHtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0XG4gICAgICAgIH1weDtib3gtc2hhZG93OiAwIDAgMTBweCAjMDAwO2JhY2tncm91bmQ6ICNmZmY7b3BhY2l0eToke3RoaXMub3BhY2l0eX07Ym9yZGVyLXJhZGl1czogNHB4O3otaW5kZXg6IDE7XCI+XG4gICAgICAgICAgICAgICAgPGNhbnZhcyBpZD1cIlNWR3BhdGhfQ2FudmFzXCIgd2lkdGg9JHt0aGlzLndpZHRofSBoZWlnaHQ9JHt0aGlzLmhlaWdodH0+PC9jYW52YXM+XG4gICAgICAgICAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IHJpZ2h0O3Bvc2l0aW9uOiByZWxhdGl2ZTt0b3A6IC0yOHB4O3BhZGRpbmc6IDAgOHB4O1wiPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwiU1ZHcGF0aF9jYW5jZWxcIj5jYW5jZWw8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cIlNWR3BhdGhfc3VyZVwiPnN1cmU8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPVwidG9wOiAtMjhweDtwb3NpdGlvbjogYWJzb2x1dGU7dG9wOiAtMTJweDtyaWdodDogMDtcIj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cIlNWR3BhdGhfZnJlZVwiPmZyZWUgbW9kZTwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwiU1ZHcGF0aF9saW5lXCI+bGluZSBtb2RlPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgYDtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmRpdik7XG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1NWR3BhdGhfQ2FudmFzJyk7XG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1NWR3BhdGhfc3VyZScpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uU3VyZSh7IGRhdGE6IHRoaXMucGF0aCwgYmFzZVdpZHRoOiB0aGlzLndpZHRoIH0pO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmRpdik7XG4gICAgICAgIH07XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdTVkdwYXRoX2NhbmNlbCcpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuZGl2KTtcbiAgICAgICAgfTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ1NWR3BhdGhfZnJlZScpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNtb2RlKCdmcmVlJyk7XG4gICAgICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLm1vZGVfZnJlZSgpO1xuICAgICAgICB9O1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnU1ZHcGF0aF9saW5lJykub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY21vZGUoJ2xpbmUnKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICAgICAgICAgIHRoaXMubW9kZV9saW5lKCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIG1vZGVfbGluZSgpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gW107XG4gICAgICAgIGxldCBpc0RyYXdpbmdfaWR4ID0gbnVsbDtcbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMztcbiAgICAgICAgY29uc3QgZmluZHEgPSAoeCwgeSkgPT4ge1xuICAgICAgICAgICAgbGV0IGlkeCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLnBhdGguZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW1bMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBpeCA9IGl0ZW1bMl1bMF07XG4gICAgICAgICAgICAgICAgY29uc3QgaXkgPSBpdGVtWzJdWzFdO1xuICAgICAgICAgICAgICAgIGlmICh4IDwgaXggKyA1ICYmIHggPiBpeCAtIDUgJiYgeSA8IGl5ICsgNSAmJiB5ID4gaXkgLSA1KSB7XG4gICAgICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGlkeDtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZHJhd19saW5lcyA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAvL+WOn+eCuVxuICAgICAgICAgICAgICAgIHRoaXMuYWRkX2FyYyh0aGlzLnBhdGhbaV1bMF0sIHRoaXMucGF0aFtpXVsxXSwgNSwgMCwgMiAqIE1hdGguUEksIGZhbHNlLCAnb3JhbmdlJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubW92ZVRvKHRoaXMucGF0aFtpXVswXSwgdGhpcy5wYXRoW2ldWzFdKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zYXZlKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGF0aFtpICsgMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHF4ID0gdGhpcy5wYXRoW2kgKyAxXVsyXVswXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHF5ID0gdGhpcy5wYXRoW2kgKyAxXVsyXVsxXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHgucXVhZHJhdGljQ3VydmVUbyhxeCwgcXksIHRoaXMucGF0aFtpICsgMV1bMF0sIHRoaXMucGF0aFtpICsgMV1bMV0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgICAgICAgICAgLy/kuK3ngrlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHgucmVzdG9yZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZF9hcmMocXgsIHF5LCA1LCAwLCAyICogTWF0aC5QSSwgZmFsc2UsICdncmF5Jyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LnNldExpbmVEYXNoKFsyLCAyXSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkX2xpbmUocXgsIHF5LCB0aGlzLnBhdGhbaV1bMF0sIHRoaXMucGF0aFtpXVsxXSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkX2xpbmUocXgsIHF5LCB0aGlzLnBhdGhbaSArIDFdWzBdLCB0aGlzLnBhdGhbaSArIDFdWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHguc2V0TGluZURhc2goW10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5jYW52YXMub25tb3VzZWRvd24gPSBlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGlucSA9IGZpbmRxKGUub2Zmc2V0WCwgZS5vZmZzZXRZKTtcbiAgICAgICAgICAgIGlmIChpbnEgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpc0RyYXdpbmdfaWR4ID0gaW5xO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFtsYXN0WCwgbGFzdFldID0gW2Uub2Zmc2V0WCwgZS5vZmZzZXRZXTtcbiAgICAgICAgICAgIHRoaXMucGF0aC5wdXNoKFtlLm9mZnNldFgsIGUub2Zmc2V0WV0pO1xuICAgICAgICAgICAgaWYgKHRoaXMucGF0aC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgbGV0IGxlbiA9IHRoaXMucGF0aC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgbGV0IHF4ID0gKGUub2Zmc2V0WCArIHRoaXMucGF0aFtsZW4gLSAyXVswXSkgLyAyO1xuICAgICAgICAgICAgICAgIGxldCBxeSA9IChlLm9mZnNldFkgKyB0aGlzLnBhdGhbbGVuIC0gMl1bMV0pIC8gMjtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGhbbGVuIC0gMV0ucHVzaChbcXgsIHF5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkcmF3X2xpbmVzKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2Vtb3ZlID0gdGhyb3R0bGUoXG4gICAgICAgICAgICBlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBmaW5kcShlLm9mZnNldFgsIGUub2Zmc2V0WSk7IC8vIOWIpOaWrem8oOagh+WcqOWTquS4quS4reeCueS4ilxuICAgICAgICAgICAgICAgIGlmIChpZHggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpc0RyYXdpbmdfaWR4ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGF0aFtpc0RyYXdpbmdfaWR4XS5zcGxpY2UoMiwgMSwgW2Uub2Zmc2V0WCwgZS5vZmZzZXRZXSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIGRyYXdfbGluZXMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgNzAsXG4gICAgICAgICAgICA4MFxuICAgICAgICApO1xuICAgICAgICB0aGlzLmNhbnZhcy5vbm1vdXNldXAgPSAoKSA9PiAoaXNEcmF3aW5nX2lkeCA9IG51bGwpO1xuICAgICAgICB0aGlzLmNhbnZhcy5tb3VzZW91dCA9ICgpID0+IChpc0RyYXdpbmdfaWR4ID0gbnVsbCk7XG4gICAgfVxuICAgIG1vZGVfZnJlZSgpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gW107XG4gICAgICAgIGxldCBpc0RyYXdpbmcgPSBmYWxzZTtcbiAgICAgICAgbGV0IGxhc3RYID0gMDtcbiAgICAgICAgbGV0IGxhc3RZID0gMDtcbiAgICAgICAgdGhpcy5jdHgubGluZUNhcCA9ICdyb3VuZCc7XG4gICAgICAgIHRoaXMuY3R4LmxpbmVKb2luID0gJ3JvdW5kJztcbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gdGhpcy5saW5lV2lkdGggfHwgNTtcbiAgICAgICAgY29uc3QgZHJhd0xpbmUgPSBlID0+IHtcbiAgICAgICAgICAgIGlmICghaXNEcmF3aW5nKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbyhsYXN0WCwgbGFzdFkpO1xuICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKGUub2Zmc2V0WCwgZS5vZmZzZXRZKTtcbiAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgW2xhc3RYLCBsYXN0WV0gPSBbZS5vZmZzZXRYLCBlLm9mZnNldFldO1xuICAgICAgICAgICAgdGhpcy5wYXRoLnB1c2goW2Uub2Zmc2V0WCwgZS5vZmZzZXRZXSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gJyM2NjY2NjYnO1xuICAgICAgICB0aGlzLmNhbnZhcy5vbm1vdXNlZG93biA9IGUgPT4ge1xuICAgICAgICAgICAgaXNEcmF3aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIFtsYXN0WCwgbGFzdFldID0gW2Uub2Zmc2V0WCwgZS5vZmZzZXRZXTtcbiAgICAgICAgICAgIHRoaXMucGF0aC5wdXNoKFtlLm9mZnNldFgsIGUub2Zmc2V0WV0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNhbnZhcy5vbm1vdXNlbW92ZSA9IHRocm90dGxlKGRyYXdMaW5lLCA1MCwgNjApO1xuICAgICAgICB0aGlzLmNhbnZhcy5vbm1vdXNldXAgPSAoKSA9PiAoaXNEcmF3aW5nID0gZmFsc2UpO1xuICAgICAgICB0aGlzLmNhbnZhcy5tb3VzZW91dCA9ICgpID0+IChpc0RyYXdpbmcgPSBmYWxzZSk7XG4gICAgfVxuICAgIGFkZF9hcmMoeCwgeSwgciwgc2EsIGVhLCBjb3VudGVyY2xvY2t3aXNlLCBjb2xvcikge1xuICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gY29sb3I7XG4gICAgICAgIHRoaXMuY3R4LmFyYyh4LCB5LCByLCBzYSwgZWEsIGNvdW50ZXJjbG9ja3dpc2UpO1xuICAgICAgICB0aGlzLmN0eC5maWxsKCk7XG4gICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gJ2JsYWNrJztcbiAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XG4gICAgfVxuICAgIGFkZF9saW5lKHN4LCBzeSwgZXgsIGV5KSB7XG4gICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICB0aGlzLmN0eC5tb3ZlVG8oc3gsIHN5KTtcbiAgICAgICAgdGhpcy5jdHgubGluZVRvKGV4LCBleSk7XG4gICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgIH1cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gW107XG4gICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIHRoaXMuY2FudmFzLm9ubW91c2Vkb3duID0gbnVsbDtcbiAgICAgICAgdGhpcy5jYW52YXMub25tb3VzZW1vdmUgPSBudWxsO1xuICAgICAgICB0aGlzLmNhbnZhcy5vbm1vdXNldXAgPSBudWxsO1xuICAgICAgICB0aGlzLmNhbnZhcy5tb3VzZW91dCA9IG51bGw7XG4gICAgfVxuICAgIGNtb2RlKG1vZGUpIHtcbiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB9XG59XG5cbi8v6IqC5rWB5Ye95pWw77yM5q2k5aSE55So5p2l5b+r6YCf55S755u057q/XG5jb25zdCB0aHJvdHRsZSA9IGZ1bmN0aW9uKGZuLCBkZWxheSwgbXVzdFJ1bkRlbGF5KSB7XG4gICAgbGV0IHRpbWVyID0gbnVsbDtcbiAgICBsZXQgdF9zdGFydDtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIGxldCBjb250ZXh0ID0gdGhpcyxcbiAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHMsXG4gICAgICAgICAgICB0X2N1cnIgPSArbmV3IERhdGUoKTtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgICAgaWYgKCF0X3N0YXJ0KSB7XG4gICAgICAgICAgICB0X3N0YXJ0ID0gdF9jdXJyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0X2N1cnIgLSB0X3N0YXJ0ID49IG11c3RSdW5EZWxheSkge1xuICAgICAgICAgICAgZm4uYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICB0X3N0YXJ0ID0gdF9jdXJyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGZuLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgfSwgZGVsYXkpO1xuICAgICAgICB9XG4gICAgfTtcbn07XG5cbi8v5bCG5LqM57u05pWw57uE6L2sc3ZnIHBhdGjmoLzlvI9cbmNvbnN0IHBhdGgyc3RyaW5nID0gKGFycmF5ID0gW10sIHJhdGlvID0gMSkgPT4ge1xuICAgIGxldCBzdHIgPSAnJztcbiAgICBhcnJheS5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICBsZXQgY2hyID0gJ0wnO1xuICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIGNociA9ICdNJztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbVsyXSkge1xuICAgICAgICAgICAgY2hyID0gYFEke2l0ZW1bMl1bMF0gKiByYXRpb30gJHtpdGVtWzJdWzFdICogcmF0aW99YDtcbiAgICAgICAgfVxuICAgICAgICBzdHIgKz0gYCR7Y2hyfSAke2l0ZW1bMF0gKiByYXRpb30gJHtpdGVtWzFdICogcmF0aW99IGA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHN0cjtcbn07XG5leHBvcnQgZGVmYXVsdCBTVkdwYXRoO1xuZXhwb3J0IHsgcGF0aDJzdHJpbmcgfTtcbiIsImltcG9ydCBTVkdwYXRoLCB7IHBhdGgyc3RyaW5nIH0gZnJvbSAnLi4vaW5kZXgnXG5jb25zdCB7IHgsIHksIHdpZHRoLCBoZWlnaHQgfSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbm5lcicpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG5sZXQgc3ZnID0gbmV3IFNWR3BhdGgoe1xuICAgIHgsXG4gICAgeSxcbiAgICB3aWR0aCxcbiAgICBoZWlnaHQsXG4gICAgb3BhY2l0eTogMC41LFxuICAgIGxpbmVXaWR0aDogMyxcbiAgICBvblN1cmU6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICBjb25zb2xlLmxvZyhwYXRoMnN0cmluZyhyZXMuZGF0YSkpXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhJykuaW5uZXJIVE1MID0gcGF0aDJzdHJpbmcocmVzLmRhdGEpXG4gICAgfVxufSlcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydCcpLm9uY2xpY2sgPSAoKSA9PiBzdmcuZHJhdygpIl0sInNvdXJjZVJvb3QiOiIifQ==